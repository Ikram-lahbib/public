
/**
 * ghtl v0.1.0
 * Copyright (c) 2022 GHTL bouzal.oussama02@gmail.com
 * Released under the MIT License.
 **/

function addli(client_id,username,timego,message,ready,older){var ul=document.getElementById("ul_noti");if(ready){ul.innerHTML="";};var li=document.createElement("li");let a=document.createElement("a");let br=document.createElement("br");let i=document.createElement("i");let span_img=document.createElement("span");let span_name=document.createElement("span");let span_tm=document.createElement("span");let span_ms=document.createElement("span");if(older){let span_plustot=document.createElement("span");span_plustot.appendChild(document.createTextNode("Plus tÃ´t"));li.appendChild(span_plustot);li.setAttribute("class", "nav-item"); ul.appendChild(li);};i.setAttribute("class","fa fa-user aero pull-left border-aero profile_thumb");span_img.appendChild(i);span_img.setAttribute("class","image");span_name.appendChild(document.createTextNode(username));span_tm.appendChild(document.createTextNode("il ya "+timego));span_tm.setAttribute("class","time");span_ms.appendChild(br);span_ms.appendChild(document.createTextNode(message));span_ms.setAttribute("class","message");a.appendChild(span_img);a.appendChild(span_name);a.appendChild(span_tm);a.appendChild(span_ms);a.setAttribute("class","dropdown-item");a.setAttribute("href","/profilClient/"+client_id);li.appendChild(a);li.setAttribute("class","nav-item");ul.appendChild(li);};function submitData(){let countDelete=0,ready=true,older=true;let req=new XMLHttpRequest();req.open('GET',"/notificationMs",true);req.send();req.onreadystatechange=function(){if(req.readyState==4&&req.status==200){let obj=JSON.parse(req.responseText);let countms=0,countelem=0;for(let i=obj.data.length-1;i >-1;i--){let elem=obj.data[i];if(elem.active === 0){countms++;let today=new Date();let creatday=new Date(elem.created_at);let diffMs=(today-creatday);let diff = Math.floor(diffMs/60000),time="minutes";if(diff>59){diff=Math.floor(diffMs/3600000);time="heures";if(diff>23){diff = Math.floor(diffMs/86400000);time="jours";if(diff>6){diff=Math.floor(diffMs/604800000);time="semaine";}}}addli(elem.client_id,elem.Name,diff+" "+time,elem.Message,ready,false);ready=false;}if(elem.active === 1){countDelete++;if(countDelete>1000){try{let req2 = new XMLHttpRequest();req2.open('GET',"/notificationDel",true);req2.send();}catch{}}}if(countelem <200){countelem++;let today = new Date();let creatday= new Date(elem.created_at);let diffMs=(today - creatday);let diff=Math.floor(diffMs/60000),time="minutes";if(diff>59){diff=Math.floor(diffMs/3600000);time="heures";if(diff>23){diff = Math.floor(diffMs / 86400000);time = "jours";if(diff>6){diff = Math.floor(diffMs / 604800000);time = "semaine";}}}addli(elem.client_id, elem.Name, diff+" "+time, elem.Message, ready, older);ready=false;older=false;}}if(countms>0){let a = document.getElementById("navbarDropdown1");let span = document.createElement("span");span.setAttribute("class", "badge bg-green");span.setAttribute("id", "badgebg-green");span.appendChild(document.createTextNode(countms));a.appendChild(span);}}}};submitData();setInterval(function(){submitData();},10000);let alink = document.getElementById("navbarDropdown1");alink.addEventListener('click',function(){try{document.getElementById("badgebg-green").style.display="none";let req=new XMLHttpRequest();req.open('GET',"/notificationUp",true);req.send();}catch{}});


